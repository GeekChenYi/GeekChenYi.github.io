---
title: 小程序自定义组件
date: 2021-02-04 11:20:00
permalink: /pages/mini-base-05/
categories:
  - 《微信小程序》笔记
tags:
  -
---
# 小程序自定义组件

## 自定义组件

> 可以将页面内的功能模块抽象成自定义组件，以便在不同的页面中重复使用；也可以将复杂的页面拆分成多个低耦合的模块，有助于代码维护。

### 创建自定义组件

自定义组件有`json`、`wxml`、`wxss`、`js` 4个文件组成，要编写一个自定义组件，首先需要在`json`文件中进行自定义组件声明

```json
{
  "component": true
}
```
同时在wxml文件中编写组件模板，在wxss中加入组件样式，他们的写法与页面的写法类似。


> **注意：在组件wxss中不应使用ID选择器、属性选择器和标签名选择器。**

在自定义组件的 js 文件中，需要使用 Component() 来注册组件，并提供组件的属性定义、内部数据和自定义方法。

### 使用自定义组件

首先要在页面的 json 文件中进行引用声明

```json
  "usingComponents": {
    "warn": "/components/warn/index" // 自定义组件路径
  }
```

### 细节注意事项

* WXML 节点标签名只能是小写字母、中划线和下划线的组合，所以自定义组件的标签名也只能包含这些字符

* 自定义组件也是可以引用自定义组件的，引用方法类似于页面引用自定义组件的方式（使用 usingComponents 字段）
* 自定义组件和页面所在项目根目录名不能以“wx-”为前缀，否则会报错
* 使用 usingComponents 页面的原型与不使用时不一致，即 Object.getPrototypeOf(this) 结果不同
* 使用 usingComponents 时会多一些方法，如 selectComponent

## 组件模板和样式

### 组件wxml的slot

默认情况下，一个组件的 wxml 中只能有一个 slot 。需要使用多 slot 时，可以在组件 js 中声明启用。

```js
Component({
  options: {
    multipleSlots: true // 在组件定义时的选项中启用多slot支持
  },
  properties: { /* ... */ },
  methods: { /* ... */ }
})

```

组件模板，可以在这个组件的 wxml 中使用多个 slot ，以不同的 name 来区分

```html
<view class="wrapper">
  <slot name="before"></slot>
  <view>这里是组件的内部细节</view>
  <slot name="after"></slot>
</view>
```

引用组件的页面模板
```html
<view>
  <component-tag-name>
    <!-- 这部分内容将被放置在组件 <slot name="before"> 的位置上 -->
    <view slot="before">这里是插入到组件slot name="before"中的内容</view>
    <!-- 这部分内容将被放置在组件 <slot name="after"> 的位置上 -->
    <view slot="after">这里是插入到组件slot name="after"中的内容</view>
  </component-tag-name>
</view>
```

### 组件样式

组件对应 `wxss` 文件的样式，只对组件`wxml`内的节点生效，除非以下两种情况：

* `app.wxss` 或页面的 `wxss` 中使用了标签名选择器（或一些其他特殊选择器）来直接指定样式，这些选择器会影响到页面和全部组件。通常情况下这是不推荐的做法。

* 指定特殊的样式隔离选项 `styleIsolation` 

```js
Component({
  options: {
    styleIsolation: 'isolated'
  }
})
```

`styleIsolation` 选项支持的取值:

* isolated 表示启用样式隔离，在自定义组件内外，使用 class 指定的样式将不会相互影响（一般情况下的默认值）；

* apply-shared 表示页面 wxss 样式将影响到自定义组件，但自定义组件 wxss 中指定的样式不会影响页面；

* shared 表示页面 wxss 样式将影响到自定义组件，自定义组件 wxss 中指定的样式也会影响页面和其他设置了 apply-shared 或 shared 的自定义组件。

如果这个 Component 构造器用于构造页面 ，则默认值为 shared ，且还有以下几个额外的样式隔离选项可用：

* page-isolated 表示在这个页面禁用 app.wxss ，同时页面的 wxss 不会影响到其他自定义组件；

* page-apply-shared 表示在这个页面禁用 app.wxss ，同时，页面 wxss 样式不会影响到其他自定义组件，但设为 shared 的自定义组件会影响到页面；

* page-shared 表示在这个页面禁用 app.wxss ，同时，页面 wxss 样式会影响到其他设为 apply-shared 或 shared 的自定义组件，也会受到设为 shared 的自定义组件的影响。 

> 从小程序基础库版本 2.10.1 开始，也可以在页面或自定义组件的 json 文件中配置 styleIsolation （这样就不需在 js 文件的 options 中再配置）。

```json
{
  "styleIsolation": "isolated"
}
```

### 外部样式类

有时候，组件希望接受外部传入的样式类，此时可以在`Component``中用externalClasses` 字段定义若干个外部样式类

```js
/* 组件 custom-component.js */
Component({
  externalClasses: ['my-class']
})
```

```html
<!-- 组件 custom-component.wxml -->
<custom-component class="my-class">这段文本的颜色由组件外的 class 决定</custom-component>
```

### 引用页面或父组件的样式

即使启用了样式隔离 isolated ，组件仍然可以在局部引用组件所在页面的样式或父组件的样式。

在页面 wxss 中定义了

```css
.blue-text {
  color: blue;
}
```
在这个组件中可以使用 ~ 来引用这个类的样式

```html
<view class="~blue-text"> 这段文本是蓝色的 </view>
```

如果在一个组件的父组件 wxss 中定义了，在这个组件中可以使用 ^ 来引用这个类的样式：

```html
<view class="^red-text"> 这段文本是红色的 </view>
```

> **注意：如果组件是比较独立、通用的组件，请优先使用外部样式类的方式，而非直接引用父组件或页面的样式。**

## Component构造器









